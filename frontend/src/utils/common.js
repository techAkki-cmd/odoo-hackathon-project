// src/common.js - Premium Shared Utilities & Foundation
// üèÜ Hackathon-Winning Implementation with Enterprise-Grade Features

// üé® Premium Professional SVG Icon Library
export const icons = {
  // Authentication & User Icons
  eye: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
  </svg>`,

  eyeOff: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
  </svg>`,

  mail: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
  </svg>`,

  user: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
  </svg>`,

  lock: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
  </svg>`,

  // Brand & Action Icons
  rocket: `<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
  </svg>`,

  sparkles: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l7 7-7 7h11l7-7-7-7H5z"></path>
  </svg>`,

  // Status & Feedback Icons
  warning: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
  </svg>`,

  success: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>`,

  error: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>`,

  info: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>`,

  // Loading & Progress Icons
  loading: `<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
  </svg>`,

  spinner: `<svg class="w-5 h-5 animate-spin" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
  </svg>`,

  // Navigation Icons
  chevronRight: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
  </svg>`,

  chevronLeft: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
  </svg>`,

  arrowRight: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
  </svg>`,

  // Dashboard Icons
  dashboard: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
  </svg>`,

  settings: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
  </svg>`,

  bell: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
  </svg>`,

  // Social & External Icons
  google: `<svg class="w-5 h-5" viewBox="0 0 24 24">
    <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
    <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
    <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
    <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
  </svg>`,

  github: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
  </svg>`,

  // Action Icons
  edit: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
  </svg>`,

  save: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
  </svg>`,

  close: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
  </svg>`
};

// üéØ Advanced Configuration Management
export const CONFIG = {
  // Authentication Settings
  PASSWORD_MIN_LENGTH: 8,
  PASSWORD_MAX_LENGTH: 128,
  EMAIL_REGEX: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,
  PHONE_REGEX: /^[\+]?[1-9][\d]{0,15}$/,

  // Security Settings
  MAX_LOGIN_ATTEMPTS: 5,
  LOGIN_TIMEOUT: 15 * 60 * 1000, // 15 minutes
  SESSION_TIMEOUT: 30 * 60 * 1000, // 30 minutes
  TOKEN_REFRESH_THRESHOLD: 5 * 60 * 1000, // 5 minutes

  // Animation & Timing
  ANIMATION_DURATION: 500,
  ANIMATION_DURATION_FAST: 300,
  ANIMATION_DURATION_SLOW: 800,
  DEBOUNCE_DELAY: 300,
  THROTTLE_DELAY: 100,

  // UI Feedback
  ERROR_TIMEOUT: 5000,
  SUCCESS_TIMEOUT: 3000,
  WARNING_TIMEOUT: 4000,
  INFO_TIMEOUT: 3000,

  // Performance
  LAZY_LOAD_THRESHOLD: 100,
  CACHE_DURATION: 5 * 60 * 1000, // 5 minutes
  MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB

  // Development
  DEBUG_MODE: import.meta.env?.DEV || process.env?.NODE_ENV === 'development',
  API_BASE_URL: import.meta.env?.VITE_API_URL || 'http://localhost:8080/api',
  APP_VERSION: '1.0.0',

  // Feature Flags
  FEATURES: {
    SOCIAL_LOGIN: true,
    DARK_MODE: true,
    ANALYTICS: true,
    PWA: true,
    NOTIFICATIONS: true,
    OFFLINE_MODE: true
  },

  // Validation Rules
  VALIDATION: {
    NAME_MIN_LENGTH: 2,
    NAME_MAX_LENGTH: 50,
    EMAIL_MAX_LENGTH: 254,
    PASSWORD_PATTERNS: {
      LOWERCASE: /[a-z]/,
      UPPERCASE: /[A-Z]/,
      NUMBERS: /[0-9]/,
      SPECIAL: /[^A-Za-z0-9]/,
      REPEATED: /(.)\1{2,}/,
      SEQUENTIAL: /(?:abc|123|xyz|789|qwe|asd|zxc)/i
    }
  },

  // Theme Configuration
  THEMES: {
    LIGHT: 'light',
    DARK: 'dark',
    AUTO: 'auto'
  },

  // Notification Types
  NOTIFICATION_TYPES: {
    SUCCESS: 'success',
    ERROR: 'error',
    WARNING: 'warning',
    INFO: 'info'
  }
};

// üé® Advanced Theme Management System
// üé® Advanced Theme Management System
export class ThemeManager {
  constructor() {
    // Initialize mediaQuery first
    this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

    // Now we can safely call getSystemPreference
    this.systemPreference = this.getSystemPreference();
    this.currentTheme = this.getStoredTheme() || CONFIG.THEMES.LIGHT;

    this.init();
  }

  init() {
    this.applyTheme(this.currentTheme);
    this.mediaQuery.addEventListener('change', this.handleSystemThemeChange.bind(this));
  }

  getStoredTheme() {
    try {
      return localStorage.getItem('theme');
    } catch (error) {
      utils.error('Failed to get stored theme:', error);
      return null;
    }
  }

  getSystemPreference() {
    // Add safety check
    if (!this.mediaQuery) {
      return CONFIG.THEMES.LIGHT;
    }
    return this.mediaQuery.matches ? CONFIG.THEMES.DARK : CONFIG.THEMES.LIGHT;
  }

  setTheme(theme) {
    this.currentTheme = theme;
    try {
      localStorage.setItem('theme', theme);
    } catch (error) {
      utils.error('Failed to store theme:', error);
    }
    this.applyTheme(theme);
    this.notifyThemeChange(theme);
  }

  applyTheme(theme) {
    const resolvedTheme = theme === CONFIG.THEMES.AUTO ? this.systemPreference : theme;

    document.documentElement.setAttribute('data-theme', resolvedTheme);
    document.documentElement.classList.toggle('dark', resolvedTheme === CONFIG.THEMES.DARK);

    // Update meta theme-color for mobile browsers
    const metaThemeColor = document.querySelector('meta[name="theme-color"]');
    if (metaThemeColor) {
      metaThemeColor.setAttribute('content', resolvedTheme === CONFIG.THEMES.DARK ? '#1a1a2e' : '#ffffff');
    }
  }

  toggleTheme() {
    const newTheme = this.currentTheme === CONFIG.THEMES.LIGHT ? CONFIG.THEMES.DARK : CONFIG.THEMES.LIGHT;
    this.setTheme(newTheme);
    return newTheme;
  }

  handleSystemThemeChange(e) {
    this.systemPreference = e.matches ? CONFIG.THEMES.DARK : CONFIG.THEMES.LIGHT;
    if (this.currentTheme === CONFIG.THEMES.AUTO) {
      this.applyTheme(CONFIG.THEMES.AUTO);
    }
  }

  notifyThemeChange(theme) {
    if (typeof window !== 'undefined') {
      window.dispatchEvent(new CustomEvent('themeChange', { detail: { theme } }));
    }
  }
}


// üõ†Ô∏è Enhanced Utility Functions Collection
export const utils = {
  // üîç Logging & Debugging
  log: (message, data = '') => {
    if (CONFIG.DEBUG_MODE) {
      const timestamp = new Date().toISOString();
      console.log(`üöÄ [${timestamp}] ${message}`, data);
    }
  },

  error: (message, data = '') => {
    if (CONFIG.DEBUG_MODE) {
      const timestamp = new Date().toISOString();
      console.error(`‚ùå [${timestamp}] ${message}`, data);
    }
  },
  throttle: (func, limit) => {
      let inThrottle;
      return function(...args) {
        if (!inThrottle) {
          func.apply(this, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      };
    },

  warn: (message, data = '') => {
    if (CONFIG.DEBUG_MODE) {
      const timestamp = new Date().toISOString();
      console.warn(`‚ö†Ô∏è [${timestamp}] ${message}`, data);
    }
  },

  // üîí Security & Validation
  sanitizeInput: (input) => {
    if (typeof input !== 'string') return input;
    return input
      .trim()
      .replace(/[<>]/g, '')
      .replace(/javascript:/gi, '')
      .replace(/on\w+=/gi, '');
  },

  validateEmail: (email) => {
    if (!email || typeof email !== 'string') return false;
    if (email.length > CONFIG.VALIDATION.EMAIL_MAX_LENGTH) return false;
    return CONFIG.EMAIL_REGEX.test(email);
  },

  validatePassword: (password) => {
    if (!password || typeof password !== 'string') return false;
    return password.length >= CONFIG.PASSWORD_MIN_LENGTH &&
           password.length <= CONFIG.PASSWORD_MAX_LENGTH;
  },

  validateName: (name) => {
    if (!name || typeof name !== 'string') return false;
    const trimmed = name.trim();
    return trimmed.length >= CONFIG.VALIDATION.NAME_MIN_LENGTH &&
           trimmed.length <= CONFIG.VALIDATION.NAME_MAX_LENGTH &&
           /^[a-zA-Z√Ä-√ø\s'-]+$/.test(trimmed);
  },

  generateSecureToken: () => {
    const array = new Uint8Array(32);
    crypto.getRandomValues(array);
    return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
  },

  // üì± Device & Browser Detection
  isMobile: () => {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  },

  isTablet: () => {
    return /iPad|Android|Tablet/i.test(navigator.userAgent) && !utils.isMobile();
  },

  isDesktop: () => {
    return !utils.isMobile() && !utils.isTablet();
  },

  getBrowserInfo: () => {
    const ua = navigator.userAgent;
    let browser = 'Unknown';

    if (ua.includes('Chrome')) browser = 'Chrome';
    else if (ua.includes('Firefox')) browser = 'Firefox';
    else if (ua.includes('Safari')) browser = 'Safari';
    else if (ua.includes('Edge')) browser = 'Edge';

    return {
      name: browser,
      userAgent: ua,
      language: navigator.language,
      platform: navigator.platform
    };
  },

  // üé® DOM Manipulation
  createElement: (tag, className = '', content = '') => {
    const element = document.createElement(tag);
    if (className) element.className = className;
    if (content) element.innerHTML = content;
    return element;
  },

  getElement: (selector) => {
    return document.querySelector(selector);
  },

  getAllElements: (selector) => {
    return document.querySelectorAll(selector);
  },

  addEventListeners: (elements, events, handler) => {
    const elementArray = Array.isArray(elements) ? elements : [elements];
    const eventArray = Array.isArray(events) ? events : [events];

    elementArray.forEach(element => {
      eventArray.forEach(event => {
        element.addEventListener(event, handler);
      });
    });
  },

  // üíæ Local Storage Management
  storage: {
    set: (key, value) => {
      try {
        const serialized = JSON.stringify({
          value,
          timestamp: Date.now(),
          expires: Date.now() + CONFIG.CACHE_DURATION
        });
        localStorage.setItem(key, serialized);
        return true;
      } catch (error) {
        utils.error('Storage set error:', error);
        return false;
      }
    },

    get: (key, defaultValue = null) => {
      try {
        const item = localStorage.getItem(key);
        if (!item) return defaultValue;

        const parsed = JSON.parse(item);

        // Check expiration
        if (parsed.expires && Date.now() > parsed.expires) {
          localStorage.removeItem(key);
          return defaultValue;
        }

        return parsed.value;
      } catch (error) {
        utils.error('Storage get error:', error);
        return defaultValue;
      }
    },

    remove: (key) => {
      try {
        localStorage.removeItem(key);
        return true;
      } catch (error) {
        utils.error('Storage remove error:', error);
        return false;
      }
    },

    clear: () => {
      try {
        localStorage.clear();
        return true;
      } catch (error) {
        utils.error('Storage clear error:', error);
        return false;
      }
    }
  },

  // üåê Network & API Utilities
  isOnline: () => navigator.onLine,

  makeRequest: async (url, options = {}) => {
    const defaultOptions = {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      timeout: 10000
    };

    const mergedOptions = { ...defaultOptions, ...options };

    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), mergedOptions.timeout);

      const response = await fetch(url, {
        ...mergedOptions,
        signal: controller.signal
      });

      clearTimeout(timeoutId);

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      return await response.json();
    } catch (error) {
      utils.error('Request failed:', error);
      throw error;
    }
  },

  // üéØ Performance Utilities
  measure: (name, fn) => {
    const start = performance.now();
    const result = fn();
    const end = performance.now();

    utils.log(`Performance [${name}]:`, `${(end - start).toFixed(2)}ms`);
    return result;
  },

  measureAsync: async (name, fn) => {
    const start = performance.now();
    const result = await fn();
    const end = performance.now();

    utils.log(`Performance [${name}]:`, `${(end - start).toFixed(2)}ms`);
    return result;
  },

  // üé® Animation Utilities
  easeInOutCubic: (t) => {
    return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
  },

  lerp: (start, end, t) => {
    return start + (end - start) * t;
  },

  clamp: (value, min, max) => {
    return Math.min(Math.max(value, min), max);
  },

  // üìÖ Date & Time Utilities
  formatDate: (date, format = 'YYYY-MM-DD') => {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    const hours = String(d.getHours()).padStart(2, '0');
    const minutes = String(d.getMinutes()).padStart(2, '0');

    const formats = {
      'YYYY-MM-DD': `${year}-${month}-${day}`,
      'DD/MM/YYYY': `${day}/${month}/${year}`,
      'MM/DD/YYYY': `${month}/${day}/${year}`,
      'YYYY-MM-DD HH:mm': `${year}-${month}-${day} ${hours}:${minutes}`,
      'relative': utils.getRelativeTime(d)
    };

    return formats[format] || formats['YYYY-MM-DD'];
  },

  getRelativeTime: (date) => {
    const now = new Date();
    const diff = now - new Date(date);
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    if (seconds < 60) return 'just now';
    if (minutes < 60) return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
    if (hours < 24) return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
    if (days < 7) return `${days} day${days !== 1 ? 's' : ''} ago`;

    return utils.formatDate(date);
  },

  // üîÑ Array & Object Utilities
  shuffle: (array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  },

  unique: (array, key = null) => {
    if (key) {
      return array.filter((item, index, self) =>
        index === self.findIndex(t => t[key] === item[key])
      );
    }
    return [...new Set(array)];
  },

  deepClone: (obj) => {
    if (obj === null || typeof obj !== 'object') return obj;
    if (obj instanceof Date) return new Date(obj.getTime());
    if (obj instanceof Array) return obj.map(item => utils.deepClone(item));

    const clonedObj = {};
    for (const key in obj) {
      if (obj.hasOwnProperty(key)) {
        clonedObj[key] = utils.deepClone(obj[key]);
      }
    }
    return clonedObj;
  },

  // üéµ Sound & Haptic Feedback
  playSound: (type = 'click') => {
    if (!CONFIG.FEATURES.NOTIFICATIONS) return;

    const sounds = {
      click: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+H...',
      success: 'data:audio/wav;base64,UklGRt4CAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YboCAAC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4...',
      error: 'data:audio/wav;base64,UklGRt4CAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YboCAADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA...'
    };

    try {
      const audio = new Audio(sounds[type] || sounds.click);
      audio.volume = 0.1;
      audio.play().catch(() => {}); // Ignore errors
    } catch (error) {
      // Fallback or ignore
    }
  },

  vibrate: (pattern = [100]) => {
    if ('vibrate' in navigator && CONFIG.FEATURES.NOTIFICATIONS) {
      navigator.vibrate(pattern);
    }
  }
};

// üåü Premium Notification System
export class NotificationManager {
  constructor() {
    this.notifications = [];
    this.container = null;
    this.maxNotifications = 5;
    this.init();
  }

  init() {
    this.createContainer();
    this.setupStyles();
  }

  createContainer() {
    if (this.container) return;

    this.container = utils.createElement('div', 'notification-container fixed top-4 right-4 z-50 space-y-3 pointer-events-none');
    document.body.appendChild(this.container);
  }

  setupStyles() {
    const style = document.createElement('style');
    style.textContent = `
      .notification {
        pointer-events: auto;
        transform: translateX(100%);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 400px;
        backdrop-filter: blur(12px);
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.hide {
        transform: translateX(100%);
        opacity: 0;
      }

      .notification-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 2px;
        background: currentColor;
        opacity: 0.3;
        transition: width linear;
      }
    `;
    document.head.appendChild(style);
  }

  show(message, type = CONFIG.NOTIFICATION_TYPES.INFO, options = {}) {
    const notification = this.createNotification(message, type, options);

    // Limit number of notifications
    if (this.notifications.length >= this.maxNotifications) {
      this.remove(this.notifications[0]);
    }

    this.notifications.push(notification);
    this.container.appendChild(notification.element);

    // Animate in
    requestAnimationFrame(() => {
      notification.element.classList.add('show');
    });

    // Auto remove
    if (options.duration !== false) {
      const duration = options.duration || this.getDefaultDuration(type);
      this.scheduleRemoval(notification, duration);
    }

    // Sound feedback
    utils.playSound(type);

    return notification;
  }

  createNotification(message, type, options) {
    const id = utils.generateSecureToken();
    const colors = this.getTypeColors(type);
    const icon = this.getTypeIcon(type);

    const element = utils.createElement('div',
      `notification bg-white/90 backdrop-blur-sm border-l-4 ${colors.border} rounded-lg shadow-lg p-4 relative overflow-hidden`
    );

    element.innerHTML = `
      <div class="flex items-start">
        <div class="flex-shrink-0 mr-3">
          <div class="${colors.iconBg} ${colors.iconText} rounded-full p-2">
            ${icon}
          </div>
        </div>

        <div class="flex-1 min-w-0">
          ${options.title ? `<h4 class="text-sm font-semibold text-gray-900 mb-1">${options.title}</h4>` : ''}
          <p class="text-sm text-gray-700">${message}</p>
          ${options.action ? `
            <button class="mt-2 text-xs ${colors.text} hover:${colors.textHover} font-medium" onclick="(${options.action})()">
              ${options.actionText || 'Action'}
            </button>
          ` : ''}
        </div>

        <button class="ml-3 text-gray-400 hover:text-gray-600 transition-colors" onclick="notificationManager.remove('${id}')">
          ${icons.close}
        </button>
      </div>

      ${options.duration !== false ? '<div class="notification-progress"></div>' : ''}
    `;

    const notification = {
      id,
      element,
      type,
      createdAt: Date.now()
    };

    return notification;
  }

  getTypeColors(type) {
    const colorMap = {
      [CONFIG.NOTIFICATION_TYPES.SUCCESS]: {
        border: 'border-green-500',
        iconBg: 'bg-green-100',
        iconText: 'text-green-600',
        text: 'text-green-600',
        textHover: 'text-green-700'
      },
      [CONFIG.NOTIFICATION_TYPES.ERROR]: {
        border: 'border-red-500',
        iconBg: 'bg-red-100',
        iconText: 'text-red-600',
        text: 'text-red-600',
        textHover: 'text-red-700'
      },
      [CONFIG.NOTIFICATION_TYPES.WARNING]: {
        border: 'border-yellow-500',
        iconBg: 'bg-yellow-100',
        iconText: 'text-yellow-600',
        text: 'text-yellow-600',
        textHover: 'text-yellow-700'
      },
      [CONFIG.NOTIFICATION_TYPES.INFO]: {
        border: 'border-blue-500',
        iconBg: 'bg-blue-100',
        iconText: 'text-blue-600',
        text: 'text-blue-600',
        textHover: 'text-blue-700'
      }
    };

    return colorMap[type] || colorMap[CONFIG.NOTIFICATION_TYPES.INFO];
  }

  getTypeIcon(type) {
    const iconMap = {
      [CONFIG.NOTIFICATION_TYPES.SUCCESS]: icons.success,
      [CONFIG.NOTIFICATION_TYPES.ERROR]: icons.error,
      [CONFIG.NOTIFICATION_TYPES.WARNING]: icons.warning,
      [CONFIG.NOTIFICATION_TYPES.INFO]: icons.info
    };

    return iconMap[type] || icons.info;
  }

  getDefaultDuration(type) {
    const durationMap = {
      [CONFIG.NOTIFICATION_TYPES.SUCCESS]: CONFIG.SUCCESS_TIMEOUT,
      [CONFIG.NOTIFICATION_TYPES.ERROR]: CONFIG.ERROR_TIMEOUT,
      [CONFIG.NOTIFICATION_TYPES.WARNING]: CONFIG.WARNING_TIMEOUT,
      [CONFIG.NOTIFICATION_TYPES.INFO]: CONFIG.INFO_TIMEOUT
    };

    return durationMap[type] || CONFIG.INFO_TIMEOUT;
  }

  scheduleRemoval(notification, duration) {
    const progressBar = notification.element.querySelector('.notification-progress');

    if (progressBar) {
      progressBar.style.width = '100%';
      progressBar.style.transitionDuration = `${duration}ms`;

      requestAnimationFrame(() => {
        progressBar.style.width = '0%';
      });
    }

    setTimeout(() => {
      this.remove(notification);
    }, duration);
  }

  remove(notification) {
    const target = typeof notification === 'string'
      ? this.notifications.find(n => n.id === notification)
      : notification;

    if (!target) return;

    target.element.classList.add('hide');

    setTimeout(() => {
      if (target.element.parentNode) {
        target.element.parentNode.removeChild(target.element);
      }

      this.notifications = this.notifications.filter(n => n.id !== target.id);
    }, 300);
  }

  clear() {
    this.notifications.forEach(notification => {
      this.remove(notification);
    });
  }
}

// üéØ Performance Optimized Debounce Function
export function debounce(func, wait, immediate = false) {
  let timeout;

  return function executedFunction(...args) {
    const later = () => {
      timeout = null;
      if (!immediate) func.apply(this, args);
    };

    const callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);

    if (callNow) func.apply(this, args);
  };
}

// ‚ö° Performance Optimized Throttle Function
export function throttle(func, limit) {
  let inThrottle;

  return function(...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// üé® Premium Floating Elements Generator
export function createFloatingElements(count = 8) {
  const elements = [];

  for (let i = 0; i < count; i++) {
    const size = 20 + Math.random() * 40;
    const left = Math.random() * 100;
    const top = Math.random() * 100;
    const delay = Math.random() * 5;
    const duration = 10 + Math.random() * 20;

    const gradients = [
      'from-primary-400/20 to-blue-500/20',
      'from-purple-400/20 to-pink-500/20',
      'from-green-400/20 to-blue-500/20',
      'from-yellow-400/20 to-orange-500/20',
      'from-indigo-400/20 to-purple-500/20',
      'from-pink-400/20 to-red-500/20'
    ];

    const gradient = gradients[Math.floor(Math.random() * gradients.length)];

    elements.push(`
      <div class="floating-element absolute rounded-full bg-gradient-to-br ${gradient} animate-float"
           style="width: ${size}px;
                  height: ${size}px;
                  left: ${left}%;
                  top: ${top}%;
                  animation-delay: ${delay}s;
                  animation-duration: ${duration}s;
                  filter: blur(1px);"></div>
    `);
  }

  return `
    <div class="floating-elements-container fixed inset-0 overflow-hidden pointer-events-none z-0">
      ${elements.join('')}
    </div>
  `;
}

// üßπ Form Error Management
export function clearFormErrors() {
  const errorElements = document.querySelectorAll('[id$="-error"], .error-message, .field-error');

  errorElements.forEach(element => {
    element.textContent = '';
    element.classList.add('hidden', 'opacity-0');
    element.classList.remove('opacity-100', 'visible');
    element.style.transform = 'translateY(-10px)';
  });

  // Clear input error states
  const inputs = document.querySelectorAll('input, textarea, select');
  inputs.forEach(input => {
    input.classList.remove('border-red-300', 'border-red-500', 'ring-red-500');
  });
}

// üé≠ Advanced Animation Controller
export class AnimationController {
  constructor() {
    this.animations = new Map();
  }

  register(name, keyframes, options = {}) {
    this.animations.set(name, { keyframes, options });
  }

  play(element, animationName, customOptions = {}) {
    const animation = this.animations.get(animationName);
    if (!animation) {
      utils.warn(`Animation '${animationName}' not found`);
      return;
    }

    const options = { ...animation.options, ...customOptions };
    return element.animate(animation.keyframes, options);
  }

  fadeIn(element, duration = CONFIG.ANIMATION_DURATION) {
    return this.play(element, 'fadeIn', { duration });
  }

  fadeOut(element, duration = CONFIG.ANIMATION_DURATION) {
    return this.play(element, 'fadeOut', { duration });
  }

  slideIn(element, direction = 'right', duration = CONFIG.ANIMATION_DURATION) {
    return this.play(element, `slideIn${direction}`, { duration });
  }

  bounce(element, duration = CONFIG.ANIMATION_DURATION) {
    return this.play(element, 'bounce', { duration });
  }
}

// üìä Analytics & Metrics
export class AnalyticsManager {
  constructor() {
    this.events = [];
    this.sessionId = this.generateSessionId();
    this.startTime = Date.now();
  }

  generateSessionId() {
    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }

  track(eventName, properties = {}) {
    if (!CONFIG.FEATURES.ANALYTICS) return;

    const event = {
      name: eventName,
      properties: {
        ...properties,
        timestamp: Date.now(),
        sessionId: this.sessionId,
        url: window.location.href,
        userAgent: navigator.userAgent
      }
    };

    this.events.push(event);
    utils.log('üìä Analytics event:', event);

    // Send to analytics service
    this.sendEvent(event);
  }

  sendEvent(event) {
    // Implementation for sending to analytics service
    // This could be Google Analytics, Mixpanel, etc.
    if (typeof gtag !== 'undefined') {
      gtag('event', event.name, event.properties);
    }
  }

  trackPageView(page) {
    this.track('page_view', { page });
  }

  trackUserAction(action, target) {
    this.track('user_action', { action, target });
  }

  trackError(error, context) {
    this.track('error', {
      message: error.message,
      stack: error.stack,
      context
    });
  }

  getSessionMetrics() {
    const sessionDuration = Date.now() - this.startTime;
    const eventCount = this.events.length;

    return {
      sessionId: this.sessionId,
      duration: sessionDuration,
      eventCount,
      events: this.events
    };
  }
}

// üåê Internationalization Support
export class I18nManager {
  constructor(defaultLanguage = 'en') {
    this.currentLanguage = defaultLanguage;
    this.translations = new Map();
    this.fallbackLanguage = 'en';
  }

  setLanguage(language) {
    this.currentLanguage = language;
    this.updateDocument();
  }

  addTranslations(language, translations) {
    this.translations.set(language, translations);
  }

  t(key, variables = {}) {
    const translation = this.getTranslation(key);
    return this.interpolate(translation, variables);
  }

  getTranslation(key) {
    const currentTranslations = this.translations.get(this.currentLanguage) || {};
    const fallbackTranslations = this.translations.get(this.fallbackLanguage) || {};

    return currentTranslations[key] || fallbackTranslations[key] || key;
  }

  interpolate(text, variables) {
    return text.replace(/\{\{(\w+)\}\}/g, (match, key) => {
      return variables[key] || match;
    });
  }

  updateDocument() {
    document.documentElement.lang = this.currentLanguage;
    document.dispatchEvent(new CustomEvent('languageChanged', {
      detail: { language: this.currentLanguage }
    }));
  }
}

// üéØ Initialize Global Instances
export const themeManager = new ThemeManager();
export const notificationManager = new NotificationManager();
export const animationController = new AnimationController();
export const analyticsManager = new AnalyticsManager();
export const i18nManager = new I18nManager();

// üé® Register Default Animations
animationController.register('fadeIn', [
  { opacity: 0, transform: 'translateY(20px)' },
  { opacity: 1, transform: 'translateY(0)' }
], { duration: 500, easing: 'ease-out' });

animationController.register('fadeOut', [
  { opacity: 1, transform: 'translateY(0)' },
  { opacity: 0, transform: 'translateY(-20px)' }
], { duration: 500, easing: 'ease-in' });

animationController.register('slideInRight', [
  { transform: 'translateX(100%)' },
  { transform: 'translateX(0)' }
], { duration: 600, easing: 'cubic-bezier(0.4, 0, 0.2, 1)' });

animationController.register('bounce', [
  { transform: 'translateY(0)' },
  { transform: 'translateY(-10px)' },
  { transform: 'translateY(0)' }
], { duration: 600, easing: 'ease-in-out' });

// üåê Make utilities globally available
if (typeof window !== 'undefined') {
  window.utils = utils;
  window.themeManager = themeManager;
  window.notificationManager = notificationManager;
  window.animationController = animationController;
  window.analyticsManager = analyticsManager;
  window.i18nManager = i18nManager;
}

// üì± PWA Support
export const pwaManager = {
  isInstallable: false,
  deferredPrompt: null,

  init() {
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      this.deferredPrompt = e;
      this.isInstallable = true;
      this.showInstallButton();
    });

    window.addEventListener('appinstalled', () => {
      this.isInstallable = false;
      this.deferredPrompt = null;
      notificationManager.show('App installed successfully!', 'success');
    });
  },

  async install() {
    if (!this.deferredPrompt) return;

    this.deferredPrompt.prompt();
    const result = await this.deferredPrompt.userChoice;

    if (result.outcome === 'accepted') {
      analyticsManager.track('pwa_install_accepted');
    } else {
      analyticsManager.track('pwa_install_declined');
    }

    this.deferredPrompt = null;
  },

  showInstallButton() {
    // Implementation to show install button
    notificationManager.show(
      'Install our app for a better experience!',
      'info',
      {
        action: 'pwaManager.install',
        actionText: 'Install',
        duration: 10000
      }
    );
  }
};

// Initialize PWA support
if (CONFIG.FEATURES.PWA) {
  pwaManager.init();
}

export default {
  icons,
  CONFIG,
  utils,
  debounce,
  throttle,
  createFloatingElements,
  clearFormErrors,
  ThemeManager,
  NotificationManager,
  AnimationController,
  AnalyticsManager,
  I18nManager,
  themeManager,
  notificationManager,
  animationController,
  analyticsManager,
  i18nManager,
  pwaManager
};
